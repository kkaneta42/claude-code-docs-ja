> ## Documentation Index
> Fetch the complete documentation index at: https://code.claude.com/docs/llms.txt
> Use this file to discover all available pages before exploring further.

# Claude Code セッションのチームを調整する

> 複数の Claude Code インスタンスがチームとして連携して動作するように調整します。共有タスク、エージェント間メッセージング、一元管理を備えています。

<Warning>
  エージェントチームは実験的機能であり、デフォルトでは無効です。`CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS` を [settings.json](/ja/settings) または環境に追加して有効にしてください。エージェントチームには、セッション再開、タスク調整、シャットダウン動作に関する [既知の制限](#limitations) があります。
</Warning>

エージェントチームを使用すると、複数の Claude Code インスタンスが連携して動作するように調整できます。1 つのセッションがチームリーダーとして機能し、作業を調整し、タスクを割り当て、結果を統合します。チームメンバーは独立して動作し、それぞれ独自のコンテキストウィンドウで作業し、互いに直接通信します。

単一セッション内で実行され、メインエージェントにのみ報告できる [subagents](/ja/sub-agents) とは異なり、リーダーを経由せずにチームメンバー個別と直接やり取りすることもできます。

このページでは、以下について説明します。

* [エージェントチームを使用する場合](#when-to-use-agent-teams)。ユースケースと subagents との比較を含みます
* [チームを開始する](#start-your-first-agent-team)
* [チームメンバーを制御する](#control-your-agent-team)。表示モード、タスク割り当て、委任を含みます
* [並列作業のベストプラクティス](#best-practices)

## エージェントチームを使用する場合

エージェントチームは、並列探索が実際の価値を追加するタスクに最も効果的です。完全なシナリオについては、[ユースケース例](#use-case-examples) を参照してください。最も強力なユースケースは以下の通りです。

* **調査とレビュー**: 複数のチームメンバーが問題のさまざまな側面を同時に調査し、その後、互いの発見を共有して異議を唱えることができます
* **新しいモジュールまたは機能**: チームメンバーは、互いに干渉することなく、別々の部分を所有できます
* **競合する仮説でのデバッグ**: チームメンバーは異なる理論を並列でテストし、より速く答えに収束します
* **クロスレイヤー調整**: フロントエンド、バックエンド、テストにまたがる変更。各チームメンバーが異なる部分を所有します

エージェントチームは調整オーバーヘッドを追加し、単一セッションよりも大幅に多くのトークンを使用します。チームメンバーが独立して動作できる場合に最適です。順序付きタスク、同じファイルの編集、または多くの依存関係を持つ作業の場合、単一セッションまたは [subagents](/ja/sub-agents) がより効果的です。

### subagents との比較

エージェントチームと [subagents](/ja/sub-agents) の両方により、作業を並列化できますが、動作方法が異なります。ワーカーが互いに通信する必要があるかどうかに基づいて選択してください。

|             | Subagents                    | エージェントチーム                      |
| :---------- | :--------------------------- | :----------------------------- |
| **コンテキスト**  | 独自のコンテキストウィンドウ。結果は呼び出し元に返される | 独自のコンテキストウィンドウ。完全に独立           |
| **通信**      | メインエージェントにのみ結果を報告            | チームメンバーが互いに直接メッセージを送信          |
| **調整**      | メインエージェントがすべての作業を管理          | 自己調整を備えた共有タスクリスト               |
| **最適な用途**   | 結果のみが重要な焦点を絞ったタスク            | 議論と協力が必要な複雑な作業                 |
| **トークンコスト** | 低い: 結果がメインコンテキストに要約される       | 高い: 各チームメンバーは個別の Claude インスタンス |

結果を報告する迅速で焦点を絞ったワーカーが必要な場合は subagents を使用してください。チームメンバーが発見を共有し、互いに異議を唱え、独立して調整する必要がある場合は、エージェントチームを使用してください。

## エージェントチームを有効にする

エージェントチームはデフォルトでは無効です。`CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS` 環境変数を `1` に設定して有効にします。シェル環境または [settings.json](/ja/settings) を通じて設定できます。

```json settings.json theme={null}
{
  "env": {
    "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1"
  }
}
```

## 最初のエージェントチームを開始する

エージェントチームを有効にした後、Claude に自然言語でエージェントチームを作成し、タスクとチーム構造を説明するよう指示します。Claude はチームを作成し、チームメンバーをスポーンし、プロンプトに基づいて作業を調整します。

この例は、3 つのロールが独立しており、互いに待つことなく問題を探索できるため、うまく機能します。

```
I'm designing a CLI tool that helps developers track TODO comments across
their codebase. Create an agent team to explore this from different angles: one
teammate on UX, one on technical architecture, one playing devil's advocate.
```

そこから、Claude は [共有タスクリスト](/ja/interactive-mode#task-list) を備えたチームを作成し、各視点のチームメンバーをスポーンし、問題を探索させ、発見を統合し、完了時に [チームをクリーンアップ](#clean-up-the-team) しようとします。

リーダーのターミナルには、すべてのチームメンバーと彼らが取り組んでいることが表示されます。Shift+Up/Down を使用してチームメンバーを選択し、直接メッセージを送信します。

各チームメンバーを独自の分割ペインに配置したい場合は、[表示モードを選択](#choose-a-display-mode) を参照してください。

## エージェントチームを制御する

リーダーに自然言語で何をしたいかを指示します。チームの調整、タスク割り当て、指示に基づいた委任を処理します。

### 表示モードを選択する

エージェントチームは 2 つの表示モードをサポートしています。

* **In-process**: すべてのチームメンバーがメインターミナル内で実行されます。Shift+Up/Down を使用してチームメンバーを選択し、入力してメッセージを直接送信します。追加のセットアップなしで任意のターミナルで動作します。
* **Split panes**: 各チームメンバーが独自のペインを取得します。すべてのユーザーの出力を一度に表示でき、ペインをクリックして直接やり取りできます。tmux または iTerm2 が必要です。

<Note>
  `tmux` には特定のオペレーティングシステムでの既知の制限があり、従来は macOS で最適に動作します。iTerm2 で `tmux -CC` を使用することが、`tmux` への推奨エントリーポイントです。
</Note>

デフォルトは `"auto"` です。これは、既に tmux セッション内で実行している場合は分割ペインを使用し、そうでない場合は in-process を使用します。`"tmux"` 設定は分割ペインモードを有効にし、ターミナルに基づいて tmux または iTerm2 を使用するかどうかを自動検出します。オーバーライドするには、[settings.json](/ja/settings) で `teammateMode` を設定します。

```json  theme={null}
{
  "teammateMode": "in-process"
}
```

単一セッションに対して in-process モードを強制するには、フラグとして渡します。

```bash  theme={null}
claude --teammate-mode in-process
```

分割ペインモードには、[tmux](https://github.com/tmux/tmux/wiki) または [`it2` CLI](https://github.com/mkusaka/it2) を備えた iTerm2 が必要です。手動でインストールするには、以下を実行します。

* **tmux**: システムのパッケージマネージャーを通じてインストールします。プラットフォーム固有の手順については、[tmux wiki](https://github.com/tmux/tmux/wiki/Installing) を参照してください。
* **iTerm2**: [`it2` CLI](https://github.com/mkusaka/it2) をインストールし、**iTerm2 → Settings → General → Magic → Enable Python API** で Python API を有効にします。

### チームメンバーとモデルを指定する

Claude はタスクに基づいてスポーンするチームメンバーの数を決定するか、正確に何をしたいかを指定できます。

```
Create a team with 4 teammates to refactor these modules in parallel.
Use Sonnet for each teammate.
```

### チームメンバーのプラン承認を要求する

複雑またはリスクの高いタスクの場合、チームメンバーが実装する前にプランを立てることを要求できます。チームメンバーは、リーダーがアプローチを承認するまで、読み取り専用プランモードで動作します。

```
Spawn an architect teammate to refactor the authentication module.
Require plan approval before they make any changes.
```

チームメンバーがプランを完了すると、リーダーにプラン承認リクエストを送信します。リーダーはプランをレビューし、承認するか、フィードバック付きで却下するかのいずれかを行います。却下された場合、チームメンバーはプランモードのままで、フィードバックに基づいて修正し、再送信します。承認されると、チームメンバーはプランモードを終了し、実装を開始します。

リーダーは自律的に承認決定を行います。リーダーの判断に影響を与えるには、プロンプトで「テストカバレッジを含むプランのみを承認する」や「データベーススキーマを変更するプランを却下する」などの基準を指定します。

### デリゲートモードを使用する

デリゲートモードがない場合、リーダーはチームメンバーを待つ代わりに、タスク自体の実装を開始することがあります。デリゲートモードは、リーダーを調整のみのツール（スポーン、メッセージング、チームメンバーのシャットダウン、タスク管理）に制限することでこれを防ぎます。

これは、リーダーが作業の分割、タスク割り当て、結果の統合に焦点を当てるように、コードに直接触れることなく、オーケストレーション全体に焦点を当てたい場合に便利です。

有効にするには、まずチームを開始し、Shift+Tab を押してデリゲートモードに切り替えます。

### チームメンバーと直接話す

各チームメンバーは、完全で独立した Claude Code セッションです。任意のチームメンバーに直接メッセージを送信して、追加の指示を与えたり、フォローアップの質問をしたり、アプローチをリダイレクトしたりできます。

* **In-process モード**: Shift+Up/Down を使用してチームメンバーを選択し、入力してメッセージを送信します。Enter を押してチームメンバーのセッションを表示し、Escape を押して現在のターンを中断します。Ctrl+T を押してタスクリストを切り替えます。
* **Split-pane モード**: チームメンバーのペインをクリックして、そのセッションと直接やり取りします。各チームメンバーは、独自のターミナルの完全なビューを持っています。

### タスクを割り当てて要求する

共有タスクリストはチーム全体の作業を調整します。リーダーはタスクを作成し、チームメンバーはそれらを処理します。タスクには 3 つの状態があります。保留中、進行中、完了。タスクは他のタスクに依存することもできます。未解決の依存関係を持つ保留中のタスクは、それらの依存関係が完了するまで要求できません。

リーダーはタスクを明示的に割り当てるか、チームメンバーが自己要求できます。

* **リーダーが割り当て**: リーダーにどのタスクをどのチームメンバーに与えるかを指示します
* **自己要求**: タスクを完了した後、チームメンバーは次の未割り当て、ブロック解除されたタスクを自動的に選択します

タスク要求はファイルロックを使用して、複数のチームメンバーが同じタスクを同時に要求しようとするときの競合状態を防ぎます。

### チームメンバーをシャットダウンする

チームメンバーのセッションを適切に終了するには、以下を実行します。

```
Ask the researcher teammate to shut down
```

リーダーはシャットダウンリクエストを送信します。チームメンバーは承認して適切に終了するか、説明付きで却下できます。

### チームをクリーンアップする

完了したら、リーダーにクリーンアップするよう指示します。

```
Clean up the team
```

これにより、共有チームリソースが削除されます。リーダーがクリーンアップを実行すると、アクティブなチームメンバーをチェックし、まだ実行中の場合は失敗するため、最初にシャットダウンしてください。

<Warning>
  常にリーダーを使用してクリーンアップしてください。チームメンバーはクリーンアップを実行しないでください。チームメンバーのチームコンテキストが正しく解決されない可能性があり、リソースが不整合な状態のままになる可能性があります。
</Warning>

## エージェントチームの仕組み

このセクションでは、エージェントチームの背後にあるアーキテクチャとメカニクスについて説明します。使用を開始したい場合は、上記の [エージェントチームを制御する](#control-your-agent-team) を参照してください。

### Claude がエージェントチームを開始する方法

エージェントチームが開始される方法は 2 つあります。

* **チームをリクエストする**: 並列作業から利益を得るタスクを Claude に与え、明示的にエージェントチームをリクエストします。Claude は指示に基づいてチームを作成します。
* **Claude がチームを提案する**: Claude がタスクが並列作業から利益を得ると判断した場合、チームの作成を提案する可能性があります。進行する前に確認します。

どちらの場合でも、制御は維持されます。Claude は承認なしにチームを作成しません。

### アーキテクチャ

エージェントチームは以下で構成されます。

| コンポーネント     | ロール                                                |
| :---------- | :------------------------------------------------- |
| **チームリーダー** | チームを作成し、チームメンバーをスポーンし、作業を調整するメイン Claude Code セッション |
| **チームメンバー** | 割り当てられたタスクで動作する個別の Claude Code インスタンス              |
| **タスクリスト**  | チームメンバーが要求して完了する作業項目の共有リスト                         |
| **メールボックス** | エージェント間の通信用メッセージングシステム                             |

表示設定オプションについては、[表示モードを選択](#choose-a-display-mode) を参照してください。チームメンバーのメッセージは自動的にリーダーに到着します。

システムはタスク依存関係を自動的に管理します。チームメンバーが他のタスクが依存するタスクを完了すると、ブロックされたタスクは手動介入なしにブロック解除されます。

チームとタスクはローカルに保存されます。

* **チーム設定**: `~/.claude/teams/{team-name}/config.json`
* **タスクリスト**: `~/.claude/tasks/{team-name}/`

チーム設定には、各チームメンバーの名前、エージェント ID、エージェントタイプを含む `members` 配列が含まれています。チームメンバーはこのファイルを読み取って、他のチームメンバーを発見できます。

### 権限

チームメンバーはリーダーの権限設定で開始します。リーダーが `--dangerously-skip-permissions` で実行する場合、すべてのチームメンバーも実行します。スポーン後、個別のチームメンバーモードを変更できますが、スポーン時にチームメンバーごとのモードを設定することはできません。

### コンテキストと通信

各チームメンバーは独自のコンテキストウィンドウを持っています。スポーンされると、チームメンバーは通常のセッションと同じプロジェクトコンテキストをロードします。CLAUDE.md、MCP サーバー、スキル。また、リーダーからのスポーンプロンプトも受け取ります。リーダーの会話履歴は引き継がれません。

**チームメンバーが情報を共有する方法:**

* **自動メッセージ配信**: チームメンバーがメッセージを送信すると、受信者に自動的に配信されます。リーダーは更新をポーリングする必要がありません。
* **アイドル通知**: チームメンバーが完了して停止すると、自動的にリーダーに通知します。
* **共有タスクリスト**: すべてのエージェントはタスクステータスを表示でき、利用可能な作業を要求できます。

**チームメンバーメッセージング:**

* **message**: 1 つの特定のチームメンバーにメッセージを送信します
* **broadcast**: すべてのチームメンバーに同時に送信します。コストはチームサイズでスケーリングするため、控えめに使用してください。

### トークン使用量

エージェントチームは単一セッションよりも大幅に多くのトークンを使用します。各チームメンバーは独自のコンテキストウィンドウを持ち、トークン使用量はアクティブなチームメンバーの数でスケーリングします。調査、レビュー、新機能作業の場合、追加のトークンは通常価値があります。ルーチンタスクの場合、単一セッションがより費用効果的です。使用ガイダンスについては、[エージェントチームトークンコスト](/ja/costs#agent-team-token-costs) を参照してください。

## ユースケース例

これらの例は、エージェントチームが並列探索が価値を追加するタスクをどのように処理するかを示しています。

### 並列コードレビューを実行する

単一のレビュアーは、一度に 1 つのタイプの問題に傾く傾向があります。レビュー基準を独立したドメインに分割することで、セキュリティ、パフォーマンス、テストカバレッジがすべて同時に徹底的に注意を受けます。プロンプトは各チームメンバーに異なるレンズを割り当てるため、重複しません。

```
Create an agent team to review PR #142. Spawn three reviewers:
- One focused on security implications
- One checking performance impact
- One validating test coverage
Have them each review and report findings.
```

各レビュアーは同じ PR から動作しますが、異なるフィルターを適用します。リーダーは完了後、3 人全員の発見を統合します。

### 競合する仮説で調査する

根本原因が不明な場合、単一のエージェントは 1 つのもっともらしい説明を見つけて停止する傾向があります。プロンプトはチームメンバーを明示的に敵対的にすることでこれと戦います。各チームメンバーの仕事は、独自の理論を調査するだけでなく、他の理論に異議を唱えることです。

```
Users report the app exits after one message instead of staying connected.
Spawn 5 agent teammates to investigate different hypotheses. Have them talk to
each other to try to disprove each other's theories, like a scientific
debate. Update the findings doc with whatever consensus emerges.
```

議論構造がここでの重要なメカニズムです。順序付き調査はアンカリングに悩まされます。1 つの理論が探索されると、その後の調査はそれに向かってバイアスされます。

複数の独立した調査官が互いに積極的に反証しようとしている場合、生き残る理論は実際の根本原因である可能性がはるかに高くなります。

## ベストプラクティス

### チームメンバーに十分なコンテキストを提供する

チームメンバーは CLAUDE.md、MCP サーバー、スキルを含むプロジェクトコンテキストを自動的にロードしますが、リーダーの会話履歴は継承しません。詳細については、[コンテキストと通信](#context-and-communication) を参照してください。スポーンプロンプトにタスク固有の詳細を含めます。

```
Spawn a security reviewer teammate with the prompt: "Review the authentication module
at src/auth/ for security vulnerabilities. Focus on token handling, session
management, and input validation. The app uses JWT tokens stored in
httpOnly cookies. Report any issues with severity ratings."
```

### タスクを適切にサイズ設定する

* **小さすぎる**: 調整オーバーヘッドが利益を超える
* **大きすぎる**: チームメンバーはチェックインなしで長時間動作し、無駄な努力のリスクが増加します
* **ちょうど良い**: 関数、テストファイル、レビューなど、明確な成果物を生成する自己完結型ユニット

<Tip>
  リーダーは作業をタスクに分割し、チームメンバーに自動的に割り当てます。十分なタスクを作成していない場合は、作業をより小さな部分に分割するよう指示してください。チームメンバーあたり 5～6 個のタスクを持つことで、すべてのユーザーが生産的に保たれ、誰かが立ち往生した場合にリーダーが作業を再割り当てできます。
</Tip>

### チームメンバーが完了するまで待つ

リーダーがチームメンバーを待つ代わりに、タスク自体の実装を開始することがあります。これに気付いた場合は、以下を実行します。

```
Wait for your teammates to complete their tasks before proceeding
```

### 調査とレビューから始める

エージェントチームが初めての場合は、明確な境界があり、コードを書く必要がないタスクから始めます。PR のレビュー、ライブラリの調査、バグの調査。これらのタスクは、並列実装に伴う調整の課題なしに、並列探索の価値を示しています。

### ファイルの競合を避ける

2 つのチームメンバーが同じファイルを編集すると、上書きが発生します。各チームメンバーが異なるファイルセットを所有するように作業を分割します。

### 監視と操舵

チームメンバーの進捗をチェックし、機能していないアプローチをリダイレクトし、発見が入ってくるにつれて統合します。チームを長時間無人で実行させると、無駄な努力のリスクが増加します。

## トラブルシューティング

### チームメンバーが表示されない

Claude にチームを作成するよう指示した後、チームメンバーが表示されない場合は、以下を実行します。

* In-process モードでは、チームメンバーは既に実行されているが、表示されていない可能性があります。Shift+Down を押してアクティブなチームメンバーをサイクルします。
* Claude に与えたタスクがチームを保証するのに十分複雑であることを確認します。Claude はタスクに基づいてチームメンバーをスポーンするかどうかを決定します。
* 明示的に分割ペインをリクエストした場合は、tmux がインストールされ、PATH で利用可能であることを確認します。
  ```bash  theme={null}
  which tmux
  ```
* iTerm2 の場合、`it2` CLI がインストールされ、Python API が iTerm2 の設定で有効になっていることを確認します。

### 権限プロンプトが多すぎる

チームメンバーの権限リクエストはリーダーにバブルアップされ、摩擦を生じさせる可能性があります。チームメンバーをスポーンする前に、[権限設定](/ja/permissions) で一般的な操作を事前承認して、中断を減らします。

### チームメンバーがエラーで停止する

チームメンバーはエラーが発生した後、回復する代わりに停止する可能性があります。In-process モードで Shift+Up/Down を使用するか、分割モードでペインをクリックして、出力をチェックしてから、以下のいずれかを実行します。

* 追加の指示を直接与える
* 作業を続行するために置き換えチームメンバーをスポーンする

### リーダーが作業完了前にシャットダウンする

リーダーは、すべてのタスクが実際に完了する前に、チームが完了したと判断する可能性があります。これが発生した場合は、続行するよう指示します。リーダーが委任する代わりに作業を開始する場合は、チームメンバーが完了するまで待つよう指示することもできます。

### 孤立した tmux セッション

チームが終了した後、tmux セッションが保持される場合、完全にクリーンアップされていない可能性があります。セッションをリストし、チームによって作成されたセッションを終了します。

```bash  theme={null}
tmux ls
tmux kill-session -t <session-name>
```

## 制限事項

エージェントチームは実験的です。注意すべき現在の制限事項は以下の通りです。

* **In-process チームメンバーでのセッション再開なし**: `/resume` と `/rewind` は in-process チームメンバーを復元しません。セッションを再開した後、リーダーは存在しなくなったチームメンバーにメッセージを送信しようとする可能性があります。これが発生した場合は、リーダーに新しいチームメンバーをスポーンするよう指示します。
* **タスクステータスが遅延する可能性**: チームメンバーはタスクを完了としてマークできず、依存タスクをブロックすることがあります。タスクが立ち往生しているように見える場合は、作業が実際に完了しているかどうかを確認し、タスクステータスを手動で更新するか、リーダーにチームメンバーをナッジするよう指示します。
* **シャットダウンが遅い可能性**: チームメンバーは現在のリクエストまたはツール呼び出しを完了してからシャットダウンします。これには時間がかかる可能性があります。
* **セッションあたり 1 つのチーム**: リーダーは一度に 1 つのチームのみを管理できます。新しいチームを開始する前に、現在のチームをクリーンアップしてください。
* **ネストされたチームなし**: チームメンバーは独自のチームまたはチームメンバーをスポーンできません。リーダーのみがチームを管理できます。
* **リーダーは固定**: チームを作成するセッションは、その生涯のリーダーです。チームメンバーをリーダーに昇格させたり、リーダーシップを譲渡したりすることはできません。
* **スポーン時に権限を設定**: すべてのチームメンバーはリーダーの権限モードで開始します。スポーン後、個別のチームメンバーモードを変更できますが、スポーン時にチームメンバーごとのモードを設定することはできません。
* **分割ペインには tmux または iTerm2 が必要**: デフォルトの in-process モードは任意のターミナルで動作します。分割ペインモードは VS Code の統合ターミナル、Windows Terminal、または Ghostty ではサポートされていません。

<Tip>
  **`CLAUDE.md` は通常通り動作**: チームメンバーは作業ディレクトリから `CLAUDE.md` ファイルを読み取ります。これを使用して、すべてのチームメンバーにプロジェクト固有のガイダンスを提供します。
</Tip>

## 次のステップ

並列作業と委任の関連アプローチを探索します。

* **軽量委任**: [subagents](/ja/sub-agents) はセッション内で調査または検証用のヘルパーエージェントをスポーンします。エージェント間調整が不要なタスクに適しています
* **手動並列セッション**: [Git worktrees](/ja/common-workflows#run-parallel-claude-code-sessions-with-git-worktrees) を使用すると、自動チーム調整なしで複数の Claude Code セッションを自分で実行できます
* **アプローチを比較**: [subagent vs agent team](/ja/features-overview#compare-similar-features) 比較を参照して、並べて比較してください
